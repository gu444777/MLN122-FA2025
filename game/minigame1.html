<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Game Thu Th·∫≠p ƒê·ªìng Xu - C√°ch m·∫°ng C√¥ng nghi·ªáp</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Georgia', 'Times New Roman', serif;
            min-height: 100vh;
            background: #8B7355;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: #2F1B0C;
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="100" height="100" opacity="0.1"><rect fill="%232F1B0C" width="100" height="100"/></svg>');
        }

        .game-container {
            background: #DEB887;
            border-radius: 4px;
            padding: 30px;
            box-shadow: 8px 8px 20px rgba(0, 0, 0, 0.4);
            border: 8px solid #8B4513;
            text-align: center;
            max-width: 800px;
            width: 90%;
        }

        .game-header {
            margin-bottom: 25px;
            border-bottom: 3px double #8B4513;
            padding-bottom: 15px;
        }

        .game-header h1 {
            font-size: 2.2em;
            margin-bottom: 10px;
            color: #2F1B0C;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
            font-weight: bold;
        }

        .game-header p {
            font-size: 1.1em;
            color: #654321;
            font-style: italic;
        }

        .game-canvas-container {
            position: relative;
            margin: 25px 0;
        }

        #gameCanvas {
            background: #A0522D;
            border-radius: 4px;
            border: 5px solid #654321;
            box-shadow: inset 0 0 20px rgba(0, 0, 0, 0.5);
        }

        .game-stats {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            background: #F5DEB3;
            padding: 15px;
            border-radius: 2px;
            border: 3px solid #8B4513;
        }

        .score-display {
            font-size: 1.4em;
            font-weight: bold;
            color: #8B4513;
        }

        .time-display {
            font-size: 1.2em;
            color: #654321;
            font-weight: bold;
        }

        .controls {
            background: #F5DEB3;
            padding: 20px;
            border-radius: 2px;
            margin-top: 20px;
            border: 3px solid #8B4513;
        }

        .controls h3 {
            margin-bottom: 15px;
            color: #8B4513;
            border-bottom: 2px solid #8B4513;
            padding-bottom: 8px;
        }

        .control-keys {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 8px;
            max-width: 180px;
            margin: 0 auto;
        }

        .key {
            background: #DEB887;
            padding: 12px;
            border-radius: 2px;
            font-weight: bold;
            border: 2px solid #8B4513;
            color: #2F1B0C;
        }

        .key.up {
            grid-column: 2;
        }

        .game-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 20px;
        }

        button {
            background: #8B4513;
            color: #F5DEB3;
            border: 2px solid #654321;
            padding: 12px 25px;
            border-radius: 2px;
            font-size: 1.1em;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: "Georgia", serif;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        button:hover {
            background: #A0522D;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
        }

        button:active {
            transform: translateY(0);
        }

        .restart-btn {
            background: #654321;
        }

        .theme-info {
            margin-top: 20px;
            padding: 15px;
            background: #F5DEB3;
            border-radius: 2px;
            font-size: 0.9em;
            border: 2px solid #8B4513;
            color: #2F1B0C;
        }

        .vintage-button {
            background: #8B4513;
            color: #F5DEB3;
            border: 2px solid #654321;
            padding: 10px 20px;
            margin: 10px;
            border-radius: 2px;
            cursor: pointer;
            font-family: "Georgia", serif;
        }

        /* Responsive */
        @media (max-width: 600px) {
            .game-container {
                padding: 20px;
            }

            .game-header h1 {
                font-size: 1.8em;
            }

            #gameCanvas {
                width: 100%;
                height: 300px;
            }
        }
    </style>
</head>

<body>
    <div class="game-container">
        <div class="game-header">
            <h1> Thu Th·∫≠p V·ªën C√¥ng Nghi·ªáp</h1>
            <p>Thu th·∫≠p ƒë·ªìng xu ƒë·ªÉ t√≠ch l≈©y v·ªën ƒë·∫ßu t∆∞ cho c√°c d·ª± √°n c√¥ng nghi·ªáp!</p>
            <button onclick="goToMainGame()"> quay l·∫°i</button>
        </div>

        <div class="game-stats">
            <div class="score-display"> V·ªën: <span id="score">0</span> ƒë·ªìng xu</div>
            <div class="time-display"> Th·ªùi gian: <span id="timer">60</span>s</div>
        </div>

        <div id="modalCanvas" class="game-canvas-container">
            <canvas id="gameCanvas" width="760" height="400"></canvas>

        </div>

        <div class="controls">
            <h3> ƒêi·ªÅu Khi·ªÉn</h3>
            <div class="control-keys">
                <div class="key"></div>
                <div class="key up">‚Üë</div>
                <div class="key"></div>
                <div class="key">‚Üê</div>
                <div class="key">‚Üì</div>
                <div class="key">‚Üí</div>
            </div>
            <p style="margin-top: 10px; opacity: 0.8;">S·ª≠ d·ª•ng ph√≠m m≈©i t√™n ƒë·ªÉ di chuy·ªÉn</p>
        </div>

        <div class="game-buttons">
            <button onclick="startGame()">B·∫Øt ƒê·∫ßu</button>
            <button class="restart-btn" onclick="restartGame()">Ch∆°i L·∫°i</button>
        </div>

        <div class="theme-info">
            <strong>üìö L·ªãch s·ª≠:</strong> Trong C√°ch m·∫°ng C√¥ng nghi·ªáp, vi·ªác t√≠ch l≈©y v·ªën l√† y·∫øu t·ªë then ch·ªët
            ƒë·ªÉ ƒë·∫ßu t∆∞ v√†o nh√† m√°y, m√°y m√≥c v√† ƒë∆∞·ªùng s·∫Øt. M·ªói ƒë·ªìng xu ƒë·∫°i di·ªán cho ngu·ªìn v·ªën c·∫ßn thi·∫øt
            ƒë·ªÉ ph√°t tri·ªÉn c√¥ng nghi·ªáp!
        </div>
    </div>
    <div id="gameend" class="modal">
        <div class="modal-dialog">
            <div class="modal-content">
                <div id="modalTitle" class="modal-header">

                </div>
            </div>
        </div>
    </div>
    <script>
        const canvas = document.getElementById("gameCanvas");
        const ctx = canvas.getContext("2d");
        const canvasenemy = document.getElementById("modalCanvas");

        const scoreDisplay = document.getElementById("score");
        const timerDisplay = document.getElementById("timer");

        // Nh√¢n v·∫≠t - ƒê·∫°i di·ªán cho nh√† c√¥ng nghi·ªáp
        let player = {
            x: 300,
            y: 200,
            size: 40,
            speed: 6,
            color: '#3498db'
        };

        let enemy = {
            x: 200,
            y: 100,
            size: 50,
            speed: 3,
            direction: Math.random() * Math.PI * 2, // Th√™m h∆∞·ªõng di chuy·ªÉn

            image: new Image()
        };
        // ƒê·ªìng xu - ƒê·∫°i di·ªán cho v·ªën ƒë·∫ßu t∆∞
        let coin = {
            x: Math.random() * (canvas.width - 30),
            y: Math.random() * (canvas.height - 30),
            size: 25,
            color: 'gold'
        };

        let score = 0;
        let gameTime = 60;
        let timer;
        let gameStarted = false;

        // ƒêi·ªÅu khi·ªÉn
        let keys = {};
        document.addEventListener("keydown", (e) => {
            if (['ArrowUp', 'ArrowDown', 'ArrowLeft', 'ArrowRight'].includes(e.key)) {
                keys[e.key] = true;
            }
        });
        document.addEventListener("keyup", (e) => {
            if (['ArrowUp', 'ArrowDown', 'ArrowLeft', 'ArrowRight'].includes(e.key)) {
                keys[e.key] = false;
            }
        });

        // H√†m v·∫Ω nh√¢n v·∫≠t (nh√† c√¥ng nghi·ªáp)
        function drawPlayer() {
            ctx.fillStyle = player.color;
            ctx.fillRect(player.x, player.y, player.size, player.size);

            // Th√™m chi ti·∫øt cho nh√¢n v·∫≠t
            ctx.fillStyle = '#2c3e50';
            ctx.fillRect(player.x + 10, player.y + 10, player.size - 20, player.size - 20);
        }

        enemy.image.src = 'anhgame/kha-banh-la-ai-35express-675x675.jpg';

        function drawEnemy() {
            if (enemy.image.complete) {
                ctx.drawImage(enemy.image, enemy.x, enemy.y, enemy.size, enemy.size);
            } else {
                // Fallback: v·∫Ω h√¨nh ch·ªØ nh·∫≠t n·∫øu ·∫£nh ch∆∞a t·∫£i xong
                ctx.fillStyle = 'red';
                ctx.fillRect(enemy.x, enemy.y, enemy.size, enemy.size);

                // V·∫Ω ch·ªØ "KB" nh∆∞ placeholder
                ctx.fillStyle = 'white';
                ctx.font = '12px Arial';
                ctx.fillText('KB', enemy.x + 15, enemy.y + 25);
            }

        }


        // H√†m v·∫Ω ƒë·ªìng xu v·ªõi hi·ªáu ·ª©ng
        function drawCoin() {
            ctx.fillStyle = coin.color;
            ctx.beginPath();
            ctx.arc(coin.x, coin.y, coin.size / 2, 0, Math.PI * 2);
            ctx.fill();

            // Hi·ªáu ·ª©ng √°nh s√°ng cho ƒë·ªìng xu
            ctx.fillStyle = 'rgba(255, 255, 255, 0.8)';
            ctx.beginPath();
            ctx.arc(coin.x - 5, coin.y - 5, coin.size / 6, 0, Math.PI * 2);
            ctx.fill();

            // K√Ω hi·ªáu ¬£ tr√™n ƒë·ªìng xu
            ctx.fillStyle = '#b8860b';
            ctx.font = 'bold 14px Arial';
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            ctx.fillText('¬£', coin.x, coin.y);
        }

        // H√†m c·∫≠p nh·∫≠t v·ªã tr√≠
        function update() {
            if (!gameStarted) return;

            // Di chuy·ªÉn nh√¢n v·∫≠t
            if (keys["ArrowUp"]) player.y -= player.speed;
            if (keys["ArrowDown"]) player.y += player.speed;
            if (keys["ArrowLeft"]) player.x -= player.speed;
            if (keys["ArrowRight"]) player.x += player.speed;

            // Gi·ªØ nh√¢n v·∫≠t trong khung
            player.x = Math.max(0, Math.min(canvas.width - player.size, player.x));
            player.y = Math.max(0, Math.min(canvas.height - player.size, player.y));

            // Va ch·∫°m coin
            const distance = Math.sqrt(
                Math.pow(player.x + player.size / 2 - coin.x, 2) +
                Math.pow(player.y + player.size / 2 - coin.y, 2)
            );

            if (distance < (player.size / 2 + coin.size / 2)) {
                score+= 10;
                scoreDisplay.textContent = score;

                coin.x = Math.random() * (canvas.width - coin.size);
                coin.y = Math.random() * (canvas.height - coin.size);

            }
        }

        // V·∫Ω game
        function draw() {
            // X√≥a canvas
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            // V·∫Ω n·ªÅn v·ªõi hi·ªáu ·ª©ng c√¥ng nghi·ªáp
            drawBackground();

            // V·∫Ω c√°c ƒë·ªëi t∆∞·ª£ng game
            drawCoin();
            drawPlayer();
            drawEnemy()
            // V·∫Ω th√¥ng tin
            drawGameInfo();
        }
        function drawBackground() {
            // N·ªÅn gradient
            const gradient = ctx.createLinearGradient(0, 0, canvas.width, canvas.height);
            gradient.addColorStop(0, '#2c3e50');
            gradient.addColorStop(1, '#34495e');
            ctx.fillStyle = gradient;
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // Th√™m hi·ªáu ·ª©ng nh√† m√°y trong n·ªÅn
            ctx.fillStyle = 'rgba(52, 73, 94, 0.3)';
            for (let i = 0; i < 5; i++) {
                ctx.fillRect(i * 150 + 50, 50, 80, 120);
                ctx.fillRect(i * 150 + 30, 170, 120, 20);
            }
        }
        function drawGameInfo() {
            ctx.fillStyle = 'white';
            ctx.font = '16px Arial';
            ctx.textAlign = 'left';
            ctx.fillText(`V·ªën: ${score} ƒë·ªìng xu`, 20, 30);
            ctx.fillText(`Th·ªùi gian: ${gameTime}s`, 20, 60);
        }

        function updateEnemy() {
            // Di chuy·ªÉn theo h∆∞·ªõng hi·ªán t·∫°i
            enemy.x += Math.cos(enemy.direction) * enemy.speed;
            enemy.y += Math.sin(enemy.direction) * enemy.speed;

            if (enemy.x <= 0 || enemy.x >= canvas.width - enemy.size) {
                enemy.direction = Math.PI - enemy.direction; // ƒê·ªïi h∆∞·ªõng ngang
            }
            if (enemy.y <= 0 || enemy.y >= canvas.height - enemy.size) {
                enemy.direction = -enemy.direction; // ƒê·ªïi h∆∞·ªõng d·ªçc
            }


            // Gi·ªØ nh√¢n v·∫≠t trong khung
            enemy.x = Math.max(0, Math.min(canvas.width - enemy.size, enemy.x));
            enemy.y = Math.max(0, Math.min(canvas.height - enemy.size, enemy.y));

            const distance1 = Math.sqrt(
                Math.pow(enemy.x + enemy.size / 2 - player.x, 2) +
                Math.pow(enemy.y + enemy.size / 2 - player.y, 2)
            );

            if (distance1 < (player.size / 2 + enemy.size / 2)) {

                endGame2();
            }
        }
        function gameLoop() {
            if (!gameStarted) return; // QUAN TR·ªåNG: D·ª´ng ngay n·∫øu game kh√¥ng ch·∫°y
            update();
            draw();
            updateEnemy();
            if (gameStarted) {
                requestAnimationFrame(gameLoop);
            }
        }

        // H√†m hi·ªÉn th·ªã modal k·∫øt th√∫c game
        function showGameEndModal() {
            // C·∫≠p nh·∫≠t n·ªôi dung modal
            document.getElementById('modalTitle').innerHTML = `
        <h3>Money you earn</h3>
        <p>S·ªë ti·ªÅn ki·∫øm ƒë∆∞·ª£c: ¬£${score}</p>
    `;

            // Hi·ªÉn th·ªã modal b·∫±ng Bootstrap 5 JS
            const modalElement = document.getElementById('gameend');
            const modal = new bootstrap.Modal(modalElement); // t·∫°o instance modal
            modal.show(); // hi·ªÉn th·ªã modal
        }
        // H√†m ƒë√≥ng modal
        function closeModal() {
            document.getElementById('gameend').style.display = 'none';
        }

        // H√†m ch∆°i l·∫°i game
        function restartGame() {
            closeModal();
            startGame(); // G·ªçi h√†m startGame c·ªßa b·∫°n ƒë·ªÉ reset game
        }

        // H√†m b·∫Øt ƒë·∫ßu game
        function startGame() {
            if (gameStarted) return;

            gameStarted = true;
            score = 0;
            gameTime = 60;
            scoreDisplay.textContent = score;
            timerDisplay.textContent = gameTime;

            // Reset v·ªã tr√≠
            player.x = 300;
            player.y = 200;

            enemy.x = 100
            enemy.y = 200

            // B·∫Øt ƒë·∫ßu ƒë·∫øm ng∆∞·ª£c
            timer = setInterval(() => {
                gameTime--;
                timerDisplay.textContent = gameTime;
                score++
                if (gameTime <= 0) {
                    
                    clearInterval(timer);
                    endGame();
                }
            }, 1000);

            gameLoop();
        }

        function endGame() {
            gameStarted = false;
            let currentMoney = parseInt(sessionStorage.getItem('money')) || 1000;
            currentMoney += score * 10;
            sessionStorage.setItem('money', currentMoney);

            cancelAnimationFrame(gameLoop);

            ctx.fillStyle = 'rgba(0, 0, 0, 0.8)';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            ctx.fillStyle = 'gold';
            ctx.font = 'bold 36px Arial';
            ctx.textAlign = 'center';
            ctx.fillText('H·∫øt gi·ªù!', canvas.width / 2, canvas.height / 2 - 50);

            ctx.fillStyle = 'white';
            ctx.font = '24px Arial';
            ctx.fillText(`T·ªïng v·ªën t√≠ch l≈©y: ${score * 10} ti·ªÅn`, canvas.width / 2, canvas.height / 2);

           

            ctx.fillStyle = '#7f8c8d';
            ctx.font = '18px Arial';
            ctx.fillText('Nh·∫•n "Ch∆°i L·∫°i" ƒë·ªÉ ti·∫øp t·ª•c ƒë·∫ßu t∆∞!', canvas.width / 2, canvas.height / 2 + 50);
        }


        function endGame2() {
            clearInterval(timer);

            gameStarted = false;
           


            cancelAnimationFrame(gameLoop);


            ctx.fillStyle = 'rgba(0, 0, 0, 0.8)';
            ctx.fillRect(0, 0, canvas.width, canvas.height);


            ctx.textAlign = 'center';

            ctx.fillStyle = 'white';
            ctx.font = '24px Arial';
            ctx.fillText(`g√† v ko c√≥ ti·ªÅn ƒë√¢u`, canvas.width / 2, canvas.height / 2);
            ctx.fillStyle = '#7f8c8d';
            ctx.font = '18px Arial';
            ctx.fillText('Nh·∫•n "Ch∆°i L·∫°i" ƒë·ªÉ ti·∫øp t·ª•c ƒë·∫ßu t∆∞!', canvas.width / 2, canvas.height / 2 + 50);
        }
        // H√†m ch∆°i l·∫°i
        function restartGame() { 
            clearInterval(timer);
            enemy.direction= Math.random() * Math.PI * 2
            startGame();
        }



        // Trong Mini Game
        function goToMainGame() {
            // Chuy·ªÉn v·ªÅ trang ch√≠nh
            window.location.href = 'game.html'; // ho·∫∑c index.html
        }

        // Kh·ªüi t·∫°o game
        draw();
    </script>
</body>

</html>